✅ 1. Selecionar o BANCO (troque pelo nome real)
USE CollabTechFile;
GO

✅ 2. Remover a coluna CaminhoArquivo (caso exista)
IF EXISTS (
    SELECT 1 
    FROM sys.columns 
    WHERE Name = N'CaminhoArquivo' 
      AND Object_ID = Object_ID(N'Documento')
)
BEGIN
    ALTER TABLE Documento DROP COLUMN CaminhoArquivo;
END
GO

✅ 3. Criar coluna Arquivo (varbinary)
IF NOT EXISTS (
    SELECT 1 
    FROM sys.columns 
    WHERE Name = N'Arquivo' 
      AND Object_ID = Object_ID(N'Documento')
)
BEGIN
    ALTER TABLE Documento ADD Arquivo VARBINARY(MAX) NULL;
END
GO

✅ 4. Criar coluna MimeType (varchar)
IF NOT EXISTS (
    SELECT 1 
    FROM sys.columns 
    WHERE Name = N'MimeType' 
      AND Object_ID = Object_ID(N'Documento')
)
BEGIN
    ALTER TABLE Documento ADD MimeType VARCHAR(100) NULL;
END
GO

✅ 5. Confirmar esquema completo da tabela Documento

A sua tabela Documento DEVE estar assim agora:

SELECT 
    IdDocumento,
    IdUsuario,
    nome,
    prazo,
    status,
    versao,
    Arquivo,
    MimeType,
    VersaoAtual,
    CriadoEm,
    NovoStatus,
    AssinadoEm,
    FinalizadoEm
FROM Documento;


Se isso retornar sem erro e com as novas colunas, você está pronto.

✅ 6. Opcional: limpar registros antigos que tinham caminho físico
UPDATE Documento
SET Arquivo = NULL, MimeType = NULL
WHERE Arquivo IS NULL;
GO
